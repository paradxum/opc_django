# Contributing

## Branching Strategy
This project uses a basic feature,master,prod strategy. Most dev work is done in master.
Create a feature branch if you are working on something that will break master.
When master is in a good state and ready for release, push it to prod.

## Semantic Versioning
This project uses Semantic Versioning tags. These are generated when a push to prod is done.
By default the patch version is bumped. Start the commit message with -bump-minor-
or -bump-major- when doing the prod commit to bump those.

## Registry Images and Tags
The following images are in the Registry
- $$PROJECT_NAME$$-app    - The Main application
- $$PROJECT_NAME$$-nginx  - The nginx ingress controller/staticfiles/mediafiles server
- cache		- A cache of images used during CI 
The following tags are used/auto-generated by CI
1. latest, prod	- The latest tested prod version
1. dev-latest, master	- The latest tested master (dev) version
1. v1.0.0	- The tagged tested prod version
1. prod-test	- The latest UNTESTED prod version
1. master-test	- The latest UNTESTED master version

## Git How-to for branching stuff
### What Branch am I on?
Always check this before starting work if you work on multiple branches.

    git status
### Bring current branch up to date with remote
    git pull
### Feature branch lifecycle
    git checkout -b mycoolfeature
    git push -u origin mycoolfeature
    <work work work>
    git checkout master
    <work on master.... cause I have other things to do>
    .....
    git checkout mycoolfeature
    <back to working on feature>
    git commit -m'commiting my feature branch'
    git push
    .....
    # Time to merge with master and kill off feature branch
    #  Step 1 - Commit anything you missed.
    git checkout mycoolfeature
    git pull
    git commit -m'feature is done dude'
    git push
    #  Step 2 - Merge with master
    git checkout master
    git pull
    git merge --no-ff --no-commit mycoolfeature
    git status	# Check for issues
    git commit -m 'Merging in mycoolfeature!'
    git push
    # Step 3 - Feature branch is done... remove from local
    git branch -d mycoolfeature
### Merge changes into prod
    git checkout master
    git pull
    git checkout prod
    git pull
    git merge --no-ff --no-commit master
    git status  # Check for issues
    # Note that -bump-minor- or -bump-major- are optional and defaults to bump patch level
    git commit -m '-bump-minor- New features now on prod'
    git push

## Configuring helm deployments.
There are typically 2 deployments that are done from a helm chart, testing and production.
The default ci/cd pipeline can deploy your testing environment automatically if set up.
### Testing (master) deployment
1. Set up everything in the CI/CD Setup guide first
2. COPY charts/SAMPLE-projectname-master.yaml to projectname-master.yaml
3. Customize projectname-master.yaml to your cluster/configuration (don't forget imagePullSecrets)
4. Commit/push it.

### Production deployment
For the most part, production deployment is set up to be manual. But the basics are:
1. Take a copy of charts/SAMPLE-projectname-prod.yaml to a safe spot that you'll deploy to prod
2. Add your chart repo to the helm install (if not already done)
3. Customize the -prod.yaml file.. things you'll set are a new secretKey, hostname, and appImageTag, imagePullSecrets
4. Do the deploy/update with the tagged chart version

For production you should only used the taged versions. so, if we were deploying chart version 1.2.7 and
app version 1.0.3 we'd set appImageTag in the -prod.yaml file to 1.0.3 then run
```helm upgrade -f projectname-prod.yaml --version 1.2.7-1.0.3 mydeployname myhelmrepo/projectname```

